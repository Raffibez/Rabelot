<!DOCTYPE html>
<html>
<head>
    <title>My S8+ Tablet Server</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #121212; color: white; }
        input { padding: 10px; width: 250px; border-radius: 5px; border: none; }
        button { padding: 10px 20px;cursor: pointer; background: #007bff; color: white; border: none; border-radius:5px; }
        ul {
            background: #1e1e1e;
            margin: 5px 0;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>S8+ Message Hub</h1>
    <input type="text" id="msgInput" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>
    <button onclick="clearAll()" style="background: #dc3545;">Clear History</button>

    <h3>Message History</h3>
    <ul id="messageList"></ul>
    
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const socket = io();
        const list = document.getElementById('messageList');

        // 1. Receive full history on connection
        socket.on("load_history", (data) => {
            list.innerHTML = '';
            data.messages.forEach(msg => addMessageToList(msg));
        });

        // 2. Receive a single new message in real-time
        socket.on("new_message", (data) => {
            addMessageToList(data.message);
        });

        // 3. Clear UI when someone clears history
        socket.on("history_cleared", () => {
            list.innerHTML = '';
        });

        function addMessageToList(msg) {
            const li = document.createElement('li');
    
            // If the message contains our bracketed timestamp, style it
            if (msg.startsWith('[')) {
                const parts = msg.split(') ');
                const meta = parts[0] + ')';
                const text = parts[1];
                li.innerHTML = `<span class="meta">${meta}</span> ${text}`;
            } else {
                li.textContent = msg;
            }
    
            list.appendChild(li);
            window.scrollTo(0, document.body.scrollHeight);
        }


        function sendMessage() {
            const input = document.getElementById('msgInput');
            if (input.value) {                   
                socket.emit("send_message", {message: input.value});
                input.value = '';
            }
        }

        function clearAll() {
            if (confirm("Delete all messages for everyone?")) {
                socket.emit("clear_history");
            }
        }
    </script>
</body>
</html>
